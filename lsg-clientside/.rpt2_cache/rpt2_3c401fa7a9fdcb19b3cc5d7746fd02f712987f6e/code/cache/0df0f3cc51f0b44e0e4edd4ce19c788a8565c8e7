{"code":"import * as alt from 'alt';\r\nimport * as game from 'natives';\r\nimport { Key } from 'client/modules/Constant/Keys/Key';\r\nimport { View } from '../Utilities/View';\r\nimport { Animation } from '../Utilities/Animation';\r\nimport { VehicleHelper } from './VehicleHelper';\r\nimport { Calculation } from '../Utilities/Calculation';\r\nexport default async () => {\r\n    let webView;\r\n    let vehicle;\r\n    let vehicleTransformData;\r\n    const player = alt.Player.local;\r\n    alt.onServer('player:enterVehicle', playerEnterVehicle);\r\n    alt.on('keyup', async (key) => {\r\n        if (key === Key.ESCAPE) {\r\n            if (webView === null || webView === undefined) {\r\n                return;\r\n            }\r\n            webView.close();\r\n        }\r\n    });\r\n    let doorLockState;\r\n    (function (doorLockState) {\r\n        doorLockState[doorLockState[\"Open\"] = 1] = \"Open\";\r\n        doorLockState[doorLockState[\"Closed\"] = 3] = \"Closed\";\r\n    })(doorLockState || (doorLockState = {}));\r\n    alt.on('keyup', async (key) => {\r\n        if (key === Key.E) {\r\n            const vehicleRange = VehicleHelper.getVehicleInRange(player.pos, 5);\r\n            if (vehicleRange === null || vehicleRange === undefined)\r\n                return;\r\n            if (player.vehicle != null)\r\n                return;\r\n            const vehicleData = vehicleRange.getSyncedMeta('vehicle:syncedData');\r\n            if (vehicleData === null || vehicleData === undefined)\r\n                return;\r\n            if (!webView) {\r\n                webView = new View();\r\n            }\r\n            vehicle = vehicleRange;\r\n            vehicleTransformData = vehicleData;\r\n            webView.open('', true, 'vehicle/interaction');\r\n            webView.on('cef-vehicle-interaction:openVehicle', openDoorLockVehicle);\r\n            webView.on('cef-vehicle-interaction:openDoor', openVehicleDoor);\r\n        }\r\n        if (key === Key.ALT) {\r\n            if (player.vehicle == null)\r\n                return;\r\n            const vehicleData = player.vehicle.getSyncedMeta('vehicle:syncedData');\r\n            if (vehicleData === null || vehicleData === undefined)\r\n                return;\r\n            if (!webView) {\r\n                webView = new View();\r\n            }\r\n            vehicleTransformData = vehicleData;\r\n            webView.open('', true, 'vehicle/interaction/into', true);\r\n            webView.on('cef-vehicle-interaction:turnEngine', turnVehicleEngine);\r\n        }\r\n    });\r\n    async function openDoorLockVehicle() {\r\n        webView.close();\r\n        if (vehicle.scriptID === null || vehicle.scriptID === undefined)\r\n            return;\r\n        if (!VehicleHelper.isVehicleOwner(vehicleTransformData, player)) {\r\n            return alt.emit('notify:error', null, 'Nie posiadasz kluczy do tego pojazdu');\r\n        }\r\n        const animation = new Animation('anim@mp_player_intmenu@key_fob@', 'fob_click_fp', 200);\r\n        await animation.loadAnimDictAsync();\r\n        if (game.getVehicleDoorLockStatus(vehicle.scriptID) !== doorLockState.Closed) {\r\n            game.setVehicleDoorsLocked(vehicle.scriptID, 3);\r\n            animation.playAnim();\r\n            return alt.emit('notify:success', null, 'Pojazd został zamknięty');\r\n        }\r\n        game.setVehicleDoorsLocked(vehicle.scriptID, 1);\r\n        animation.playAnim();\r\n        return alt.emit('notify:success', null, 'Pojazd został otwarty');\r\n    }\r\n    async function openVehicleDoor(door) {\r\n        webView.close();\r\n        if (vehicle.scriptID === null || vehicle.scriptID === undefined)\r\n            return;\r\n        if (VehicleHelper.isVehicleLocked(vehicle)) {\r\n            return alt.emit('notify:error', null, 'Ten pojazd jest zamknięty, musisz go otworzyć');\r\n        }\r\n        if (VehicleHelper.isDoorOpen(vehicle, door)) {\r\n            return game.setVehicleDoorShut(vehicle.scriptID, door, false);\r\n        }\r\n        return game.setVehicleDoorOpen(vehicle.scriptID, door, false, false);\r\n    }\r\n    async function playerEnterVehicle(seat) {\r\n        if (seat === 1) {\r\n            game.setPedConfigFlag(player.scriptID, 429, true);\r\n        }\r\n    }\r\n    async function turnVehicleEngine() {\r\n        webView.close();\r\n        if (player.vehicle === null || player.vehicle === undefined) {\r\n            return alt.emit('notify:error', null, 'Musisz znajdywać się w pojeździe, aby wykonać tą operacje');\r\n        }\r\n        if (!VehicleHelper.isVehicleOwner(vehicleTransformData, player)) {\r\n            return alt.emit('notify:error', null, 'Nie posiadasz kluczy do tego pojazdu');\r\n        }\r\n        if (VehicleHelper.isVehicleEngineBroken(player.vehicle)) {\r\n            const fireProbability = Calculation.probability(30);\r\n            if (fireProbability) {\r\n                alt.setTimeout(() => {\r\n                    game.addExplosion(player.vehicle.pos.x, player.vehicle.pos.y, player.vehicle.pos.z, 19, 10.5, true, false, 1.0, true);\r\n                    alt.setTimeout(() => {\r\n                        game.addExplosion(player.vehicle.pos.x, player.vehicle.pos.y, player.vehicle.pos.z, 3, 10.5, true, false, 1.0, false);\r\n                    }, 1000);\r\n                }, 2000);\r\n                if (game.getIsVehicleEngineRunning(player.vehicle.scriptID)) {\r\n                    game.setVehicleHandbrake(vehicle.scriptID, true);\r\n                }\r\n                return;\r\n            }\r\n            if (!game.getIsVehicleEngineRunning(player.vehicle.scriptID)) {\r\n                alt.emit('notify:warning', 'Przekręcono kluczyk', 'Próbuje odpalić silnik');\r\n                const engineOnProbability = Calculation.probability(50);\r\n                if (!engineOnProbability) {\r\n                    alt.setTimeout(() => {\r\n                        alt.emit('notify:error', '', 'Nie udało się uruchomić silnika');\r\n                    }, 2000);\r\n                    return;\r\n                }\r\n                alt.setTimeout(() => {\r\n                    return game.setVehicleEngineOn(player.vehicle.scriptID, true, false, true);\r\n                }, 2000);\r\n            }\r\n        }\r\n        if (!game.getIsVehicleEngineRunning(player.vehicle.scriptID) && !VehicleHelper.isVehicleEngineBroken(player.vehicle)) {\r\n            return game.setVehicleEngineOn(player.vehicle.scriptID, true, false, true);\r\n        }\r\n        return game.setVehicleEngineOn(player.vehicle.scriptID, false, false, true);\r\n    }\r\n};\r\n","references":["B:/Projekty/LSGamble-Clientside/lsg-clientside/modules/Constant/Keys/Key.ts","B:/Projekty/LSGamble-Clientside/lsg-clientside/modules/Core/Utilities/View.ts","B:/Projekty/LSGamble-Clientside/lsg-clientside/modules/Models/vehicle.ts","B:/Projekty/LSGamble-Clientside/lsg-clientside/modules/Core/Utilities/Animation.ts","B:/Projekty/LSGamble-Clientside/lsg-clientside/modules/Core/Vehicle/VehicleHelper.ts","B:/Projekty/LSGamble-Clientside/lsg-clientside/modules/Core/Utilities/Calculation.ts"]}
